from drivers.ssd1306 import SSD1306_I2C
import framebuf

class BigNum:
    def __init__(self, display):
        self.display = display
    
    @staticmethod
    def getNum(n):
        if n == 0:    
            return bytearray(b'\x00\x1f\xf8\x00\x00?\xfc\x00\x00\x7f\xfe\x00\x00\xff\xff\x00\x01\xff\xff\x80\x01\xff\xff\x80\x03\xff\xff\xc0\x03\xfe\x7f\xc0\x03\xfe\x7f\xc0\x03\xfc?\xc0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xc0\x03\xfe\x7f\xc0\x03\xfe\x7f\xc0\x03\xff\xff\xc0\x01\xff\xff\x80\x01\xff\xff\x80\x00\xff\xff\x00\x00\x7f\xfe\x00\x00?\xfc\x00\x00\x1f\xf8\x00')
        elif n == 1:
            return bytearray(b'\x00\x00\xff\x00\x00\x00\xff\x00\x00\x01\xff\x00\x00\x03\xff\x00\x00\x07\xff\x00\x00\x0f\xff\x00\x00?\xff\x00\x00\xff\xff\x00\x00\xff\xff\x00\x00\xff\xff\x00\x00\xff\xff\x00\x00\xff\xff\x00\x00\xff\xff\x00\x00\xfd\xff\x00\x00\xf1\xff\x00\x00\x81\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00')
        elif n == 2:
            return bytearray(b'\x00\x1f\xfc\x00\x00\x7f\xff\x00\x00\xff\xff\x80\x01\xff\xff\xc0\x03\xff\xff\xe0\x03\xff\xff\xe0\x07\xff\xff\xf0\x07\xfe?\xf0\x07\xfc\x1f\xf0\x07\xfc\x1f\xf0\x07\xfc\x1f\xf0\x01\xfc?\xf0\x00\x00?\xf0\x00\x00\x7f\xe0\x00\x00\xff\xe0\x00\x01\xff\xc0\x00\x03\xff\xc0\x00\x07\xff\x80\x00\x0f\xff\x00\x00\x1f\xfe\x00\x00?\xfc\x00\x00\x7f\xf8\x00\x00\xff\xf0\x00\x01\xff\xe0\x00\x03\xff\xff\xf0\x03\xff\xff\xf0\x07\xff\xff\xf0\x07\xff\xff\xf0\x07\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0')
        elif n == 3:
            return bytearray(b'\x00?\xf8\x00\x00\x7f\xfe\x00\x00\xff\xff\x00\x01\xff\xff\x80\x03\xff\xff\xc0\x07\xff\xff\xc0\x07\xff\xff\xc0\x07\xfc\x7f\xe0\x0f\xfc\x7f\xe0\x0f\xf8\x7f\xe0\x01\xf8\x7f\xc0\x00\x07\xff\xc0\x00\x0f\xff\xc0\x00\x0f\xff\x80\x00\x0f\xff\x00\x00\x0f\xff\x80\x00\x0f\xff\xc0\x00\x0f\xff\xe0\x00\x1e\x7f\xe0\x00\x00?\xf0\x00\x18\x1f\xf0\x0f\xf8\x1f\xf0\x0f\xf8\x1f\xf0\x0f\xfc?\xf0\x0f\xfe\x7f\xf0\x07\xff\xff\xe0\x07\xff\xff\xe0\x03\xff\xff\xc0\x03\xff\xff\x80\x01\xff\xff\x00\x00\xff\xfe\x00\x00?\xf8\x00')
        elif n == 4:
            return bytearray(b'\x00\x00\xff\x00\x00\x00\xff\x00\x00\x01\xff\x00\x00\x01\xff\x00\x00\x03\xff\x00\x00\x07\xff\x00\x00\x07\xff\x00\x00\x0f\xff\x00\x00\x1f\xff\x00\x00\x1f\xff\x00\x00?\xff\x00\x00\x7f\xff\x00\x00\x7f\xff\x00\x00\xff\xff\x00\x01\xff\xff\x00\x01\xff\xff\x00\x03\xfe\xff\x00\x07\xfc\xff\x00\x07\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x00\x00\xff\x00\x00\x00\xff\x00\x00\x00\xff\x00\x00\x00\xff\x00\x00\x00\xff\x00')
        elif n == 5:
            return bytearray(b'\x00\xff\xff\xe0\x00\xff\xff\xe0\x01\xff\xff\xe0\x01\xff\xff\xe0\x01\xff\xff\xe0\x01\xff\xff\xe0\x01\xff\xff\xe0\x01\xff\xff\xe0\x03\xfe\x00\x00\x03\xff\xf8\x00\x03\xff\xfe\x00\x03\xff\xff\x00\x03\xff\xff\x80\x07\xff\xff\xc0\x07\xff\xff\xe0\x07\xff\xff\xe0\x07\xff\xff\xe0\x07\xf8?\xf0\x00\xf0?\xf0\x00\x00\x1f\xf0\x00\x00\x1f\xf0\x0f\xf8\x1f\xf0\x0f\xf8?\xf0\x0f\xfc?\xf0\x0f\xfe\x7f\xe0\x07\xff\xff\xe0\x07\xff\xff\xe0\x03\xff\xff\xc0\x03\xff\xff\x80\x01\xff\xff\x00\x00\xff\xfe\x00\x00?\xf8\x00')
        elif n == 6:
            return bytearray(b'\x00\x1f\xfc\x00\x00?\xff\x00\x00\x7f\xff\x80\x00\xff\xff\xc0\x01\xff\xff\xc0\x03\xff\xff\xe0\x03\xff\xff\xe0\x07\xfe?\xe0\x07\xfe?\xe0\x07\xfc\x1f\xe0\x07\xff\xf8\x00\x0f\xff\xfe\x00\x0f\xff\xff\x00\x0f\xff\xff\x80\x0f\xff\xff\xc0\x0f\xff\xff\xe0\x0f\xff\xff\xe0\x0f\xfe?\xe0\x0f\xfc?\xf0\x0f\xfc\x1f\xf0\x0f\xfc\x1f\xf0\x0f\xfc\x1f\xf0\x07\xfc\x1f\xf0\x07\xfe\x1f\xf0\x07\xff?\xf0\x03\xff\xff\xe0\x03\xff\xff\xe0\x01\xff\xff\xc0\x01\xff\xff\xc0\x00\xff\xff\x80\x00\x7f\xfe\x00\x00\x1f\xfc\x00')
        elif n == 7:
            return bytearray(b'\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xf0\x0f\xff\xff\xc0\x00\x00\xff\x80\x00\x01\xff\x80\x00\x01\xff\x00\x00\x03\xfe\x00\x00\x07\xfe\x00\x00\x07\xfc\x00\x00\x0f\xfc\x00\x00\x0f\xf8\x00\x00\x1f\xf8\x00\x00\x1f\xf0\x00\x00\x1f\xf0\x00\x00?\xf0\x00\x00?\xe0\x00\x00?\xe0\x00\x00?\xe0\x00\x00\x7f\xe0\x00\x00\x7f\xe0\x00\x00\x7f\xc0\x00\x00\x7f\xc0\x00\x00\x7f\xc0\x00\x00\x7f\xc0\x00\x00\x7f\xc0\x00\x00\xff\xc0\x00\x00\xff\x80\x00')
        elif n == 8:
            return bytearray(b'\x00\x1f\xf8\x00\x00\x7f\xfe\x00\x00\xff\xff\x00\x01\xff\xff\x80\x01\xff\xff\x80\x03\xff\xff\xc0\x03\xff\xff\xc0\x03\xfe\x7f\xc0\x03\xfc?\xc0\x03\xfc?\xc0\x03\xfe\x7f\xc0\x03\xff\xff\xc0\x01\xff\xff\x80\x01\xff\xff\x80\x00\xff\xff\x00\x01\xff\xff\x80\x01\xff\xff\x80\x03\xff\xff\xc0\x03\xff\xff\xc0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfe\x7f\xe0\x07\xff\xff\xe0\x03\xff\xff\xc0\x03\xff\xff\xc0\x01\xff\xff\x80\x00\xff\xff\x00\x00\x7f\xfe\x00\x00\x1f\xf8\x00')
        elif n == 9:
            return bytearray(b'\x00\x1f\xf8\x00\x00\x7f\xfc\x00\x00\xff\xfe\x00\x01\xff\xff\x00\x01\xff\xff\x80\x03\xff\xff\x80\x03\xff\xff\xc0\x07\xfe\xff\xc0\x07\xfc\x7f\xc0\x07\xfc\x7f\xc0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc?\xe0\x07\xfc\x7f\xe0\x07\xfe\x7f\xe0\x03\xff\xff\xe0\x03\xff\xff\xe0\x01\xff\xff\xe0\x01\xff\xff\xe0\x00\xff\xff\xe0\x00?\xff\xe0\x00\x0f\xff\xe0\x07\xfc?\xc0\x07\xfc\x7f\xc0\x03\xfe\xff\xc0\x03\xff\xff\x80\x03\xff\xff\x80\x03\xff\xff\x00\x01\xff\xff\x00\x00\xff\xfe\x00\x00\x7f\xfc\x00\x00?\xf0\x00')
        else:
            return bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')

    def printNum(self, value, x, y):
        #se minore di zero è zero
        if value < 0: value=0
        if value < 10:
            # Arrotonda il numero a tre decimali
            rounded_num = round(value, 3)    
            # Converti il numero in stringa
            num_str = f"{rounded_num:.3f}"
        else:
            # Arrotonda il numero a due decimale
            rounded_num = round(value, 2)    
            # Converti il numero in stringa
            num_str = f"{rounded_num:.2f}"
            
        # Calcola il numero di zeri necessari da aggiungere
        zero_padding = 5 - len(num_str)
        # Aggiungi gli zeri a sinistra
        formatted_str = '0' * zero_padding + num_str
            
        # Posizione iniziale di x
        x1 = x
        
        # Itera su ogni carattere della stringa
        for digit in formatted_str:
            if digit == '.':
                pointpos = x1
            else:
                # Ottieni il valore intero del carattere
                n = int(digit)
                
                # Ottieni il bytearray per il numero
                num_data = self.getNum(n)
                
                # Verifica la dimensione del bytearray
                if len(num_data) != 128:
                    print(f"Errore: la dimensione del bytearray per il numero {n} è {len(num_data)} byte, ma dovrebbe essere 128 byte.")
                    continue
                
                # Chiama la funzione Stampa con i parametri appropriati
                #print(f'digit vale {n}')
                #print(num_data)
                
                try:
                    digit_img = framebuf.FrameBuffer(num_data, 32, 32, framebuf.MONO_HLSB)
                    self.display.blit(digit_img, x1, y)
                except ValueError as e:
                    print(f"Errore nella creazione di FrameBuffer per il numero {n}: {e}")
                
                # Incrementa la posizione x di 32
                x1 += 28
        
        #disegno il punto decimale nella posizione che mi sono salvato prima
        self.display.fill_rect(pointpos,y+27,5,5,1)
        
    def printRawNum(self, value, x, y):
        formatted_str = str(value)
            
        # Posizione iniziale di x
        x1 = x
        
        # Itera su ogni carattere della stringa
        for digit in formatted_str:
            # Ottieni il valore intero del carattere
            n = int(digit)
            
            # Ottieni il bytearray per il numero
            num_data = self.getNum(n)
                
            digit_img = framebuf.FrameBuffer(num_data, 32, 32, framebuf.MONO_HLSB)
            self.display.blit(digit_img, x1, y)
            
            # Incrementa la posizione x di 32
            x1 += 32
